@{
    ViewData["Title"] = "Visualizar Candidatura";
    Layout = "~/Views/Shared/_LayoutWhite.cshtml";
}

<link href="~/css/cimob.css" rel="stylesheet" />

<div class="candidatura-wrapper cimob">
    <ul>
        <li data-id="geral" class="active">Geral</li>
        <li data-id="contactos">Escola de Destino</li>
        <li data-id="documentacao">Documentação</li>
        <li data-id="destino">Avaliação</li>
    </ul>

    <div class="tab-content">
        <div id="geral" role="tab">
            @Html.Partial("GeneralInformation")
        </div>
        <div id="contactos" role="tab">
            @Html.Partial("Destination")
        </div>
        <div id="documentacao" role="tab">
            @Html.Partial("Documentation")
        </div>
        <div id="destino" role="tab">
            @Html.Partial("Avaliation")
        </div>
    </div>

    <div class="buttons">
        <span id="btn_back" class="button button-back">Voltar</span>
        <span id="btn_next" class="button button-next">Seguinte</span>
    </div>
</div>

@section Scripts {
    <script>
        $(() => {
            var curr = window.location.hash.split("#/")[1];

            if (curr != undefined || curr != "geral") {
                changePage();
            }
            
            bindEvents();
        });

        var bindEvents = () => {
            $(window).on("hashchange", (ev) => {
                changePage();
            });

            $(".candidatura-wrapper li").on("click", (ev) => {
                window.location.hash = "/" + ev.currentTarget.getAttribute("data-id");
            });

            $("#btn_next").on("click", (ev) => {
                var curr = window.location.hash.split("#/")[1];

                if (curr == "" || curr == undefined || curr == "geral") {
                    window.location.hash = "/contactos"
                }
                else if (curr == "contactos") {
                    window.location.hash = "/documentacao"
                }
                else if (curr == "documentacao") {
                    window.location.hash = "/destino"
                    $("#btn_next").hide();
                }
            });

            $("#btn_back").on("click", (ev) => {
                var id = window.location.hash.split("#/")[1];

                if (id == "geral" || id == undefined || id == "")
                    window.location = "/ServicosCimob/Candidaturas";
                else if (id == "contactos") {
                    window.location.hash = "/geral"
                }
                else if (id == "documentacao") {
                    window.location.hash = "/contactos"
                }
                else if (id == "destino") {
                    window.location.hash = "/documentacao"
                    $("#btn_next").show();
                }
            });
        }

        var changePage = () => {
                $("[role='tab']").hide();
                $(".active").removeClass("active");
                var id = window.location.hash.split("#/")[1];

                if (id == "destino") {
                    $("#btn_submit").show();
                    $("#btn_next").hide();
                }
                else {
                    $("#btn_submit").hide();
                    $("#btn_next").show();
                }

                if (id == undefined || id == "") {
                    $("#geral").show();
                    $("[data-id='geral']").addClass("active");
                }
                else {
                    $("#" + id).show();
                    $("ul [data-id='" + id + "']").addClass("active");
                }
            };

   </script>
}